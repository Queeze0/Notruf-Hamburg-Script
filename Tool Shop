-- LocalScript in StarterPlayerScripts

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- Zielkoordinaten
local targetPosition = Vector3.new(-738.9591674804688, 17.60025978088379, 673.0227661132812)

-- Funktion, um den Abstand zwischen zwei Positionen zu berechnen
local function getDistance(pos1, pos2) 
    return (pos1 - pos2).Magnitude
end

-- Schwelle, um die Genauigkeit der Teleportation zu überprüfen
local teleportThreshold = 5 -- Du kannst den Wert anpassen

-- Funktion, um den Spieler und das Fahrzeug zu teleportieren
local function teleport()
    local success = false -- Um zu tracken, ob die Teleportation erfolgreich war

    -- Überprüfe, ob das Fahrzeug des Spielers im Workspace existiert
    local vehicleModel = game.Workspace.Vehicles:FindFirstChild(player.Name)
    
    if vehicleModel then
        -- Suche den DriveSeat innerhalb des Spielerfahrzeugs
        local driveSeat = vehicleModel:FindFirstChild("DriveSeat")
        
        if driveSeat and driveSeat.Occupant == character.Humanoid then
            -- Wenn der Spieler im DriveSeat sitzt, teleportiere das Fahrzeug

            -- Setze das PrimaryPart, falls es nicht gesetzt ist
            if not vehicleModel.PrimaryPart then
                vehicleModel.PrimaryPart = driveSeat -- Setze den DriveSeat als PrimaryPart
            end

            -- Teleportiere das Fahrzeug
            vehicleModel:SetPrimaryPartCFrame(CFrame.new(targetPosition))
            print("Das Fahrzeug wurde zu den Koordinaten teleportiert: X: " .. targetPosition.X .. ", Y: " .. targetPosition.Y .. ", Z: " .. targetPosition.Z)

            -- Überprüfen, ob das Fahrzeug richtig teleportiert wurde
            local distance = getDistance(vehicleModel.PrimaryPart.Position, targetPosition)
            if distance <= teleportThreshold then
                success = true
            end
        else
            print("Du sitzt nicht im DriveSeat.")
        end
    end

    -- Wenn kein Fahrzeug vorhanden ist, teleportiere den Spieler
    if not success then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            humanoidRootPart.CFrame = CFrame.new(targetPosition)
            print("Du wurdest zu den Koordinaten teleportiert: X: " .. targetPosition.X .. ", Y: " .. targetPosition.Y .. ", Z: " .. targetPosition.Z)
        else
            print("HumanoidRootPart wurde nicht gefunden. Teleportation fehlgeschlagen.")
        end
    end
end

-- Wiederhole die Teleportation maximal 3 Mal
for attempt = 1, 3 do
    -- Führe die Teleportation aus
    teleport()

    -- Warte einen kleinen Moment, bevor die Position überprüft wird
    wait(1)

    -- Überprüfe, ob der Spieler oder das Fahrzeug an den richtigen Koordinaten ist
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if humanoidRootPart then
        local characterDistance = getDistance(humanoidRootPart.Position, targetPosition)

        -- Wenn der Charakter nahe genug an den Zielkoordinaten ist, beende die Schleife
        if characterDistance <= teleportThreshold then
            print("Der Charakter ist erfolgreich an den Zielkoordinaten angekommen.")
            break
        else
            print("Der Charakter ist noch nicht an den Zielkoordinaten. Versuch " .. attempt .. " fehlgeschlagen, versuche es erneut...")
        end
    end
end
